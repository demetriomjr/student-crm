<core:FragmentDefinition
	xmlns="sap.m"
	xmlns:core="sap.ui.core"
	xmlns:form="sap.ui.layout.form"
	xmlns:unified="sap.ui.unified">
	<Dialog
		id="studentDetailDialog"
		title="{detailForm>/title}"
		contentWidth="700px"
		contentHeight="90%"
		draggable="false"
		resizable="false"
		afterClose="onCancelDetailForm">
		<content>
			<form:SimpleForm
				id="studentForm"
				editable="true"
				layout="ResponsiveGridLayout"
				labelSpanXL="4"
				labelSpanL="4"
				labelSpanM="12"
				labelSpanS="12"
				adjustLabelSpan="false"
				emptySpanXL="0"
				emptySpanL="0"
				emptySpanM="0"
				emptySpanS="0"
				columnsXL="1"
				columnsL="1"
				columnsM="1"
				singleContainerFullSize="false">
				<form:content>
					<VBox>
						<Label
							text="{i18n>fullName}"
							required="true"
							labelFor="fullNameInput" />
						<Input
							id="fullNameInput"
							value="{detailForm>/student/fullname}"
							placeholder="{i18n>namePlaceholder}"
							valueState="None"
							maxLength="150"
							width="100%" />
						<HBox
							alignContent="Stretch"
							alignItems="Center"
							class="sapUiSmallMarginTop">
							<VBox
								width="calc(100% - 160px)"
								class="sapUiSmallMarginEnd"
								alignContent="Stretch">
								<layoutData>
									<FlexItemData growFactor="1" />
								</layoutData>
								<Label
									text="{i18n>email}"
									required="true"
									labelFor="emailInput" />
								<Input
									id="emailInput"
									value="{detailForm>/student/email}"
									placeholder="{i18n>emailPlaceholder}"
									valueState="None"
									type="Email"
									maxLength="100"
									width="100%" />
							</VBox>
							<VBox width="150px">
								<Label
									text="{i18n>balance}"
									labelFor="balanceDisplay" />
								<ObjectNumber
									id="balanceDisplay"
									number="{
										path: 'detailForm>/student/balance',
										formatter: '.formatter.formatBalanceDisplay'
									}"
									state="{
										path: 'detailForm>/student/balance',
										formatter: '.formatter.formatBalanceState'
									}"
									textDirection="LTR" />
							</VBox>
						</HBox>
						<Button
							text="{i18n>addReceipt}"
							type="Emphasized"
							icon="sap-icon://add"
							press="onAddReceipt"
							visible="{= !${detailForm>/showReceiptEditor}}"
							class="sapUiSmallMarginTop sapUiSizeCompact" />
						<Table
							id="receiptsTable"
							visible="{= !${detailForm>/showReceiptEditor}}"
							class="sapUiSizeCompact sapUiSmallMarginTop"
							items="{receipts>/receipts}"
							inset="false">
							<columns>
								<Column>
									<HBox
										justifyContent="Start"
										alignItems="Center">
										<Link
											text="{i18n>receiptAmount}"
											press="onReceiptColumnSort">
											<customData>
												<core:CustomData
													key="sortProperty"
													value="amount" />
											</customData>
										</Link>
										<core:Icon
											id="sortIconReceiptAmount"
											src="sap-icon://navigation-up-arrow"
											size="0.75rem"
											color="Default"
											visible="false"
											class="sapUiTinyMarginBegin" />
									</HBox>
								</Column>
								<Column>
									<HBox
										justifyContent="Start"
										alignItems="Center">
										<Link
											text="{i18n>receiptDate}"
											press="onReceiptColumnSort">
											<customData>
												<core:CustomData
													key="sortProperty"
													value="date" />
											</customData>
										</Link>
										<core:Icon
											id="sortIconReceiptDate"
											src="sap-icon://navigation-up-arrow"
											size="0.75rem"
											color="Default"
											visible="false"
											class="sapUiTinyMarginBegin" />
									</HBox>
								</Column>
								<Column>
									<Text text="{i18n>actions}" />
								</Column>
							</columns>
							<items>
								<ColumnListItem>
									<cells>
										<ObjectNumber
											number="{ path: 'receipts>amount', formatter: '.formatter.formatBalanceDisplay' }"
											state="{ path: 'receipts>amount', formatter: '.formatter.formatBalanceState' }" />
										<Text text="{path: 'receipts>date', formatter: '.formatter.formatDate'}" />
										<HBox>
											<Button
												type="Transparent"
												icon="sap-icon://show"
												press="onViewReceiptFile"
												enabled="{= !!${receipts>fileName}}"
												tooltip="{i18n>viewFile}" />
											<Button
												type="Transparent"
												icon="sap-icon://edit"
												press="onEditReceipt"
												tooltip="{i18n>editReceipt}" />
											<Button
												type="Transparent"
												icon="sap-icon://delete"
												press="onDeleteReceipt"
												tooltip="{i18n>deleteTooltip}" />
										</HBox>
									</cells>
								</ColumnListItem>
							</items>
						</Table>
					</VBox>
				</form:content>
			</form:SimpleForm>
			<Panel
				id="receiptEditor"
				visible="{detailForm>/showReceiptEditor}"
				class="sapUiSmallMarginTop"
				headerText="{i18n>editReceipt}">
				<VBox>
					<HBox>
						<VBox
							width="130px"
							class="sapUiSmallMarginEnd">
							<Label text="{i18n>receiptAmount}" />
							<Input
								id="receiptAmountInput"
								value="{detailForm>/currentReceipt/amount}"
								placeholder="{i18n>amountPlaceholder}"
								type="Text"
								textAlign="End"
								liveChange="onReceiptAmountChange"
								change="onReceiptAmountCursorMove" />
						</VBox>
						<VBox
							class="sapUiSmallMarginStart sapUiSmallMarginEnd"
							width="145px">
							<Label text="{i18n>receiptDate}" />
							<DatePicker
								id="receiptDatePicker"
								value="{detailForm>/currentReceipt/date}"
								placeholder="{i18n>datePlaceholder}"
								displayFormat="dd/MM/yyyy"
								liveChange="onReceiptDateChange"
								change="onReceiptDateBlur" />
						</VBox>
						<VBox
							class="sapUiSmallMarginStart"
							alignContent="SpaceAround"
							justifyContent="Center">
							<Label
								text="{i18n>receiptFile}"
								labelFor="receiptFileUploader" />
							<HBox
								class="sapUiSmallMarginStart"
								alignItems="Center">
								<unified:FileUploader
									id="receiptFileUploader"
									buttonOnly="true"
									buttonText="{= ${detailForm>/currentReceipt/fileName} ? ${i18n>replaceFile} : ${i18n>uploadFile}}"
									icon="sap-icon://upload"
									style="Emphasized"
									fileType="pdf,jpg,jpeg,png,gif"
									mimeType="application/pdf,image/*"
									change="onUploadReceiptFile"
									class="sapUiSmallMarginStart sapUiSizeCompact sapUiSmallMarginEnd" />
								<HBox
									visible="{= !!${detailForm>/currentReceipt/fileName}}"
									class="sapUiTinyMarginStart">
									<core:Icon
										src="sap-icon://attachment"
										size="1rem"
										class="sapUiSmallMarginStart sapUiTinyMarginEnd sapUiSmallMarginTop" />
									<Text
										text="{detailForm>/currentReceipt/fileName}"
										class="sapUiSmallMarginStart sapUiTinyMarginEnd sapUiSmallMarginTop" />
									<Button
										type="Transparent"
										icon="sap-icon://show"
										press="onViewReceiptFileInEditor"
										tooltip="{i18n>viewFile}"
										class="sapUiSmallMarginStart" />
									<Button
										type="Transparent"
										icon="sap-icon://delete"
										press="onRemoveReceiptFile"
										tooltip="{i18n>removeFile}"
										class="sapUiTinyMarginStart" />
								</HBox>
								<Text
									text="{i18n>noFileAttached}"
									class="sapUiSmallMarginStart sapUiSmallMarginTop"
									visible="{= !${detailForm>/currentReceipt/fileName}}" />
							</HBox>
						</VBox>
					</HBox>
					<Toolbar class="sapUiSmallMarginTop">
						<Button
							text="{i18n>saveBtn}"
							press="onSaveReceipt"
							type="Emphasized"
							class="sapUiSizeCompact" />
						<Button
							text="{i18n>cancelBtn}"
							press="onCancelReceiptEdit" />
					</Toolbar>
				</VBox>
			</Panel>
		</content>
		<buttons>
			<Button
				text="{detailForm>/saveButtonText}"
				type="Emphasized"
				press="onSaveStudent" />
			<Button
				text="{i18n>cancelBtn}"
				press="onCancelDetailForm" />
		</buttons>
	</Dialog>
</core:FragmentDefinition>
